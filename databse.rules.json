{
    "rules": {
      "users": {
        "$userId": {
          ".read": "auth != null && auth.uid == $userId",
          ".write": "auth != null && auth.uid == $userId && (!newData.hasChild('role') || newData.child('role').val() == 'user' || newData.child('role').val() == 'driver')",
          ".validate": "newData.hasChildren(['email', 'role']) && newData.child('email').isString() && (newData.child('role').val() == 'user' || newData.child('role').val() == 'driver')"
        }
      },
      "bookings": {
        ".read": "auth != null && (data.child('userId').val() == auth.uid || data.child('driverId').val() == auth.uid)",
        ".indexOn": ["userId", "driverId", "status"],
        "$bookingId": {
          ".write": "auth != null && ((!data.exists() && newData.child('userId').val() == auth.uid) || (data.exists() && (data.child('userId').val() == auth.uid || data.child('driverId').val() == auth.uid)))",
          ".validate": "newData.hasChildren(['userId', 'pickupLocation', 'dropoffLocation', 'dateTime', 'fare', 'status']) && newData.child('userId').isString() && newData.child('pickupLocation').isString() && newData.child('dropoffLocation').isString() && newData.child('dateTime').isString() && newData.child('fare').isNumber() && (newData.child('status').val() == 'pending' || newData.child('status').val() == 'accepted' || newData.child('status').val() == 'completed' || newData.child('status').val() == 'cancelled' || newData.child('status').val() == 'denied')"
        }
      }
    }
  }